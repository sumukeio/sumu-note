# 弹窗替换进度

## 目标
将所有原生 `confirm()` 和 `alert()` 替换为应用内部的 Dialog 和 Toast。

## 替换规则
- **危险操作确认**（删除、永久删除等）→ Dialog 确认
- **信息提示**（成功、失败、警告）→ Toast 提示
- **输入操作**（重命名、编辑等）→ Dialog 表单

---

## 已完成 ✅

### 1. Toast 组件创建
- ✅ `src/components/ui/toast.tsx` - Toast 组件
- ✅ `src/components/ui/use-toast.ts` - Toast Hook
- ✅ `src/components/ui/toaster.tsx` - Toaster 容器
- ✅ `src/app/layout.tsx` - 添加 Toaster 到根布局

### 2. NoteManager.tsx（高优先级）
- ✅ 删除当前笔记 → Dialog 确认
- ✅ 批量删除（回收站）→ Dialog 确认
- ✅ 批量还原 → Toast 提示
- ✅ 复制内容 → Toast 提示
- ✅ 重命名笔记 → Dialog 表单
- ✅ 发布/取消发布 → Toast 提示
- ✅ 图片上传成功/失败 → Toast 提示
- ✅ 普通列表视图删除 / 移动 / 新建（笔记 & 文件夹）→ Toast 提示 + 撤销按钮（Undo）

### 3. SegmentedEditor.tsx
- ✅ 链接跳转确认 → Dialog 确认

### 4. FolderManager.tsx
- ✅ 删除文件夹确认 → Dialog
- ✅ 移动文件夹确认 → Dialog
- ✅ 重命名失败提示 → Toast

### 5. ExportDialog.tsx
- ✅ 加载失败提示 → Toast
- ✅ 导出成功/失败提示 → Toast

### 6. AuthModal.tsx
- ✅ 注册/登录提示 → Toast

### 7. TodoList.tsx
- ✅ 批量删除任务确认 → Dialog
- ✅ 批量操作失败提示 → Toast（完成/删除/移动/标签/优先级）
- ✅ 关键批量操作（删除等）→ Toast 提示 + 撤销按钮（按功能逐步接入）

### 8. TodoContextMenu.tsx
- ✅ 删除任务确认 → Dialog

### 9. TodoListSidebar.tsx
- ✅ 删除清单确认 → Dialog
- ✅ 操作失败提示 → Toast（创建/更新清单失败）

### 10. TodoDetail.tsx
- ✅ 删除任务确认 → Dialog
- ✅ 删除子任务确认 → Dialog
- ✅ 操作失败提示 → Toast（保存/删除/更新失败）

### 11. MindNoteEditor.tsx
- ✅ 删除节点确认 → Dialog
- ✅ 操作失败提示 → Toast（加载/移动节点失败）

### 15. Toast + Undo 交互模式（补充）

- **适用场景（提供撤销按钮）**
  - 软删除类操作：如笔记移入回收站、从列表中删除但可恢复的内容。
  - 可逆的批量操作：如批量移动笔记/文件夹到其他位置。
  - 误触概率高且可安全回滚的创建类操作：如新建空白笔记/子文件夹。
- **不适用场景（仅提示，不提供撤销）**
  - 回收站中的“彻底删除”这类不可逆操作。
  - 账号级、配置级等高风险操作（如退出登录等）。
- **设计约定**
  - 默认撤销窗口为 **5 秒**，Toast 右侧统一使用「撤销」按钮。
  - 撤销成功后再弹出一条短 Toast，说明“已撤销 ×× 操作”，便于用户确认当前状态。
  - 所有带撤销的 Toast 均通过 `undoAction` 回调实现，逻辑集中在业务组件中，Toast 自身只负责触发。

### 12. MindNoteManager.tsx
- ✅ 批量删除确认 → Dialog
- ✅ 操作失败提示 → Toast（保存/删除/移动失败）

### 13. DraggableMindNode.tsx
- ✅ 删除节点确认 → 交由父组件处理（通过回调）

### 14. dashboard/settings/page.tsx
- ✅ 设置保存成功/失败 → Toast

---

## 待替换 ⏳

**所有组件已完成替换！** 🎉

---

## 替换模板

### Dialog 确认模板
```tsx
const [confirmDialogOpen, setConfirmDialogOpen] = useState(false);

<Dialog open={confirmDialogOpen} onOpenChange={setConfirmDialogOpen}>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>确认操作</DialogTitle>
      <DialogDescription>
        操作描述...
      </DialogDescription>
    </DialogHeader>
    <DialogFooter>
      <Button variant="outline" onClick={() => setConfirmDialogOpen(false)}>
        取消
      </Button>
      <Button variant="destructive" onClick={handleConfirm}>
        确认
      </Button>
    </DialogFooter>
  </DialogContent>
</Dialog>
```

### Toast 提示模板
```tsx
const { toast } = useToast();

// 成功提示
toast({
  title: "操作成功",
  description: "详细描述",
  variant: "success",
});

// 失败提示
toast({
  title: "操作失败",
  description: "错误信息",
  variant: "destructive",
});

// 普通提示
toast({
  title: "提示",
  description: "信息",
  variant: "default",
});
```

---

## 更新记录
- 2026-01-XX: 创建文档，开始替换 NoteManager.tsx 和 SegmentedEditor.tsx
- 2026-01-XX: 完成 FolderManager.tsx、ExportDialog.tsx、AuthModal.tsx 的弹窗替换
- 2026-01-XX: 完成 TodoList.tsx 的弹窗替换（批量删除确认 Dialog + 所有批量操作错误提示 Toast）
- 2026-01-XX: 完成所有剩余组件的弹窗替换（TodoContextMenu, TodoListSidebar, TodoDetail, MindNoteEditor, MindNoteManager, DraggableMindNode, dashboard/settings/page.tsx）

## 统计
- **已完成组件数**: 14 个
- **待替换组件数**: 0 个
- **完成进度**: 100% ✅

## 总结
所有原生 `alert()`、`confirm()` 和 `prompt()` 已全部替换为应用内部的 Dialog 和 Toast 组件。应用现在拥有统一的、美观的、响应式的用户交互体验。
