# 思维笔记功能改进任务清单

> 基于需求文档，一比一复刻幕布功能
> 任务按优先级和依赖关系排序

---

## 📋 Phase 1: 核心快捷键完善（高优先级）

### Task 1.1: 实现撤销/重做功能
**目标**：实现完整的撤销/重做系统，支持所有操作的回退

**需求**：
- ✅ 支持 Ctrl+Z / Cmd+Z 撤销
- ✅ 支持 Ctrl+Y / Cmd+Y 重做
- ✅ 撤销/重做栈管理（建议最多保存50步）
- ✅ 支持的操作类型：
  - 节点创建
  - 节点删除
  - 节点内容修改
  - 节点移动（拖拽）
  - 节点层级变化（缩进/提升）
  - 节点展开/折叠状态
  - 文档标题修改

**技术实现**：
- 创建 `useUndoRedo` hook 管理撤销/重做栈
- 每个操作记录操作类型、参数、反向操作
- 在 `MindNoteEditor` 中集成撤销/重做逻辑
- 添加撤销/重做按钮到工具栏（可选）

**预计工作量**：4-6小时

---

### Task 1.2: 完善编辑模式快捷键
**目标**：完善编辑模式下的快捷键，提升编辑效率

**需求**：
- ✅ Ctrl+A / Cmd+A：全选当前节点内容（编辑模式）
- ✅ Ctrl+B / Cmd+B：加粗选中文本（待富文本支持）
- ✅ Ctrl+I / Cmd+I：斜体选中文本（待富文本支持）
- ✅ Ctrl+K / Cmd+K：插入链接（待链接功能支持）
- ✅ 方向键导航：上下键在节点间切换焦点（非编辑模式）

**技术实现**：
- 在 `DraggableMindNode` 的 `handleKeyDown` 中添加 Ctrl+A 处理
- 方向键导航需要在 `MindNoteEditor` 中实现节点焦点管理
- 富文本相关快捷键先预留接口，待富文本功能实现后再完善

**预计工作量**：2-3小时（基础功能），富文本相关待后续

---

### Task 1.3: 全局快捷键完善
**目标**：实现全局快捷键，提升操作效率

**需求**：
- ✅ Ctrl+N / Cmd+N：新建思维笔记（跳转到创建页面）
- ✅ Ctrl+F / Cmd+F：聚焦搜索框（如果存在）
- ✅ Ctrl+S / Cmd+S：手动保存（显示保存状态）
- ✅ Ctrl+/ / Cmd+/：显示/隐藏快捷键帮助

**技术实现**：
- 在 `MindNoteEditor` 的全局快捷键处理中添加
- 新建笔记需要路由跳转
- 搜索框聚焦需要 ref 管理
- 快捷键帮助已实现，只需添加快捷键触发

**预计工作量**：2-3小时

---

## 📋 Phase 2: UI/UX 细节优化（中优先级）

### Task 2.1: 节点对齐和竖线位置验证
**目标**：确保所有节点的圆点和竖线完美对齐

**需求**：
- ✅ 验证所有层级的节点圆点在同一垂直线上
- ✅ 验证竖线从父节点圆点中心延伸到最后一个子节点
- ✅ 验证缩进时节点对齐正确
- ✅ 修复可能存在的对齐偏差

**技术实现**：
- 检查 `DraggableMindNode` 中的圆点位置计算
- 检查竖线的 `left` 位置计算
- 使用浏览器开发者工具测量实际像素位置
- 确保所有缩进级别的一致性

**预计工作量**：1-2小时（主要是测试和微调）

---

### Task 2.2: 节点选择体验优化
**目标**：优化节点选择交互，提升用户体验

**需求**：
- ✅ 方向键上下：在节点间切换选择（非编辑模式）
- ✅ 方向键左右：展开/折叠节点（非编辑模式）
- ✅ 空格键：切换当前选中节点的展开/折叠状态
- ✅ 选中节点时显示更明显的视觉反馈

**技术实现**：
- 在 `MindNoteEditor` 中实现节点焦点管理
- 添加方向键事件处理
- 优化选中状态的视觉样式

**预计工作量**：3-4小时

---

### Task 2.3: 拖拽体验优化
**目标**：优化拖拽交互，使其更流畅和直观

**需求**：
- ✅ 拖拽时显示更清晰的预览效果
- ✅ 拖拽到无效区域时的反馈
- ✅ 拖拽时禁用页面滚动（避免误操作）
- ✅ 移动端拖拽的触摸优化

**技术实现**：
- 优化 `DragOverlay` 的显示效果
- 添加拖拽时的页面滚动锁定
- 优化移动端触摸拖拽的灵敏度

**预计工作量**：2-3小时

---

## 📋 Phase 3: 内容增强功能（中优先级）

### Task 3.1: Markdown 基础支持
**目标**：支持 Markdown 语法，提升内容表达能力

**需求**：
- ✅ 支持 Markdown 语法输入和渲染
- ✅ 支持常用 Markdown 语法：
  - 粗体 `**text**`
  - 斜体 `*text*`
  - 代码 `\`code\``
  - 链接 `[text](url)`
  - 列表（可选，因为已有层级结构）
- ✅ 编辑时显示 Markdown 源码，预览时渲染
- ✅ 或使用所见即所得编辑器

**技术实现**：
- 集成 Markdown 编辑器（如 `react-markdown` 或 `@uiw/react-md-editor`）
- 或使用富文本编辑器（如 `slate` 或 `tiptap`）
- 更新 `MindNodeContent` 组件支持 Markdown 渲染

**预计工作量**：6-8小时

---

### Task 3.2: 链接功能
**目标**：支持内部链接和外部链接

**需求**：
- ✅ 支持插入外部链接 `[文本](URL)`
- ✅ 支持插入内部链接（链接到其他思维笔记或节点）
- ✅ 链接预览和跳转
- ✅ Ctrl+K 快捷键插入链接

**技术实现**：
- 扩展 Markdown 链接语法
- 实现内部链接的解析和跳转
- 添加链接插入 UI（弹窗或内联）

**预计工作量**：4-6小时

---

### Task 3.3: 图片支持
**目标**：支持在节点中插入图片

**需求**：
- ✅ 支持插入图片（上传到 Supabase Storage）
- ✅ 图片预览和缩放
- ✅ 图片拖拽上传
- ✅ 图片大小限制和压缩

**技术实现**：
- 集成 Supabase Storage
- 实现图片上传组件
- 在节点内容中支持图片显示
- 添加图片上传的拖拽区域

**预计工作量**：6-8小时

---

## 📋 Phase 4: 高级功能（低优先级）

### Task 4.1: 虚拟滚动优化
**目标**：优化大量节点时的性能

**需求**：
- ✅ 实现虚拟滚动，只渲染可见节点
- ✅ 支持快速滚动和跳转
- ✅ 保持展开/折叠状态

**技术实现**：
- 使用 `react-window` 或 `react-virtualized`
- 需要重新设计节点渲染逻辑
- 保持拖拽功能正常工作

**预计工作量**：8-10小时

---

### Task 4.2: 导出功能
**目标**：支持导出为多种格式

**需求**：
- ✅ 导出为 Markdown
- ✅ 导出为 PDF
- ✅ 导出为图片（PNG/JPG）
- ✅ 导出为纯文本

**技术实现**：
- Markdown 导出：遍历节点树生成 Markdown
- PDF 导出：使用 `jsPDF` 或 `puppeteer`
- 图片导出：使用 `html2canvas` 截图
- 添加导出按钮和选项菜单

**预计工作量**：6-8小时

---

### Task 4.3: 待办事项功能
**目标**：支持节点待办标记

**需求**：
- ✅ 节点前显示复选框
- ✅ 支持待办/完成状态切换
- ✅ 待办节点视觉区分
- ✅ 统计待办数量

**技术实现**：
- 在节点数据中添加 `is_todo` 和 `is_completed` 字段
- 更新数据库 schema
- 在 UI 中显示复选框
- 添加待办统计显示

**预计工作量**：4-6小时

---

### Task 4.4: 思维导图视图
**目标**：支持切换为思维导图视图

**需求**：
- ✅ 一键切换大纲视图和思维导图视图
- ✅ 思维导图自动布局
- ✅ 支持节点拖拽调整位置
- ✅ 支持缩放和平移

**技术实现**：
- 使用 `react-d3-tree` 或 `react-flow` 等库
- 实现视图切换逻辑
- 保持数据同步

**预计工作量**：10-12小时

---

## 📋 Phase 5: 其他优化（低优先级）

### Task 5.1: 模板系统
**目标**：支持使用模板快速创建笔记

**需求**：
- ✅ 提供常用模板（会议记录、读书笔记、项目规划等）
- ✅ 支持自定义模板
- ✅ 模板预览和选择

**技术实现**：
- 创建模板数据表
- 实现模板选择 UI
- 模板应用逻辑

**预计工作量**：4-6小时

---

### Task 5.2: 版本历史
**目标**：支持查看和恢复历史版本

**需求**：
- ✅ 自动保存版本快照
- ✅ 版本历史列表
- ✅ 版本对比
- ✅ 版本恢复

**技术实现**：
- 实现版本快照机制
- 版本历史 UI
- 版本对比和恢复逻辑

**预计工作量**：8-10小时

---

### Task 5.3: 协作功能（未来）
**目标**：支持多人实时协作

**需求**：
- ⏳ 多人实时编辑
- ⏳ 光标位置显示
- ⏳ 评论系统
- ⏳ 权限管理

**技术实现**：
- 使用 WebSocket 或 Supabase Realtime
- 实现冲突解决机制
- 添加协作 UI

**预计工作量**：20+小时（大型功能）

---

## 📊 任务优先级总结

### 🔴 高优先级（立即执行）
1. **Task 1.1**: 撤销/重做功能 ⭐⭐⭐⭐⭐
2. **Task 1.2**: 完善编辑模式快捷键 ⭐⭐⭐⭐
3. **Task 1.3**: 全局快捷键完善 ⭐⭐⭐⭐

### 🟡 中优先级（近期执行）
4. **Task 2.1**: 节点对齐验证 ⭐⭐⭐
5. **Task 2.2**: 节点选择体验优化 ⭐⭐⭐
6. **Task 2.3**: 拖拽体验优化 ⭐⭐⭐
7. **Task 3.1**: Markdown 基础支持 ⭐⭐⭐⭐
8. **Task 3.2**: 链接功能 ⭐⭐⭐

### 🟢 低优先级（后续规划）
9. **Task 3.3**: 图片支持 ⭐⭐
10. **Task 4.1**: 虚拟滚动优化 ⭐⭐
11. **Task 4.2**: 导出功能 ⭐⭐
12. **Task 4.3**: 待办事项功能 ⭐⭐
13. **Task 4.4**: 思维导图视图 ⭐
14. **Task 5.1**: 模板系统 ⭐
15. **Task 5.2**: 版本历史 ⭐

---

## 🎯 建议执行顺序

### 第一阶段（核心功能完善）
1. Task 1.1 - 撤销/重做（最重要）
2. Task 1.2 - 编辑快捷键完善
3. Task 1.3 - 全局快捷键
4. Task 2.1 - 对齐验证

### 第二阶段（体验优化）
5. Task 2.2 - 节点选择优化
6. Task 2.3 - 拖拽优化
7. Task 3.1 - Markdown 支持

### 第三阶段（功能扩展）
8. Task 3.2 - 链接功能
9. Task 3.3 - 图片支持
10. Task 4.3 - 待办事项

### 第四阶段（高级功能）
11. Task 4.1 - 虚拟滚动
12. Task 4.2 - 导出功能
13. Task 4.4 - 思维导图视图

---

## 📝 注意事项

1. **每个任务完成后**，更新需求文档中的状态（✅ 或 ⏳）
2. **测试覆盖**：每个功能都要进行充分测试
3. **用户体验**：始终以用户体验为第一优先级
4. **性能考虑**：注意性能影响，及时优化
5. **代码质量**：保持代码整洁，添加必要注释

---

## 🔄 更新日志

- **2024-12-XX**：创建任务清单
- 待任务完成后更新...








