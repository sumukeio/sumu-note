## 移动端编辑体验优化 PRD（笔记编辑页 - NoteManager / SegmentedEditor）

- **产品名称**：Sumu Note  
- **模块名称**：普通笔记编辑页（移动端）  
- **文档版本**：V1.0  
- **状态**：Draft  
- **作者**：AI Assistant  
- **最后更新**：2026-02-20  

---

## 1. 背景与目标

- **背景**
  - 当前移动端笔记编辑页在真机上存在两大痛点：
    - 可编辑区域很小：键盘 + 底部固定工具栏 + 上方标题/标签区叠加，占用大量竖向空间。
    - 编辑时页面跳动：开始编辑或输入过程中，页面容易被“拉回顶部”或出现不稳定的滚动。
- **目标**
  - 在保持功能完整的前提下，显著提升移动端编辑时“可见内容面积”和“滚动稳定性”。
  - 优先保证：用户在手机上连续写作时，视线集中在正文区域，不会被工具栏和滚动异常打断。

---

## 2. 问题定义

### 2.1 问题 1：编辑区域过小

- 键盘弹出后，屏幕实际剩余可视高度有限。
- 当前布局同时占用空间的元素：
  - 顶部：标题输入 + 标签区 + 工具按钮。
  - 中部：固定高度的编辑容器 + 多段 Textarea + 段间较大间距（SegmentedEditor）。
  - 底部：常驻的固定工具栏（多按钮、较高）。
- 用户感受：  
  “下面键盘挡一截，上面按钮又挡一截，中间只剩一小条能写字。”

### 2.2 问题 2：编辑时自动跳到顶部 / 滚动不稳定

- 父级滚动容器在内容变化、视图切换时强制恢复 `scrollTop`。
- `SegmentedEditor` 内部也在恢复光标和 textarea 的滚动位置。
- 移动浏览器在键盘弹出/聚焦时，会自行滚动页面以保证输入框可见。
- 多重逻辑叠加，造成：
  - 开始编辑后页面突然回到顶部或旧位置。
  - 输入时页面轻微抖动或“抢滚动”。

---

## 3. 用户与使用场景

- **目标用户**
  - 主要在手机上使用 Sumu Note 记录：日常想法、会议纪要、灵感草稿的个人用户。

- **典型场景**
  - 通勤路上、沙发上、开会现场，单手持机 + 软键盘输入为主。
  - 以“连续输入文本”为主，偶尔插入表格、引用、标签等。

---

## 4. 用户故事（User Stories）

- **US-1：写作空间**
  - 作为一个移动端用户，
  - 我在输入时希望屏幕上的大部分区域都是正文内容，
  - 这样我可以更专注地写作，不被各种按钮挤压视野。

- **US-2：稳定视图**
  - 作为一个移动端用户，
  - 当我开始编辑某一段内容时，
  - 希望页面保持在当前段落附近，不会突然跳到顶部或别处。

- **US-3：低干扰的工具访问**
  - 作为一个移动端用户，
  - 我希望常用操作（保存、预览、专注模式）随手可达，
  - 但不会长期占据大量竖向空间，特别是在键盘弹出时。

- **US-4：误触后的可恢复性**
  - 作为一个移动端用户，
  - 当我在手机上不小心删除或移动了笔记时，
  - 希望在短时间内可以通过明显的 Toast 撤销该操作，而不必进入回收站或复杂界面查找。

---

## 5. 总体方案概述

### 5.1 总体策略

1. 优先保证输入过程中的视野与稳定性（不乱跳、不被遮挡）。
2. 工具栏从“常驻横条”改为“需要时出现 / 不需要时收起”的轻量形态。
3. 为移动端编辑引入“写作模式”（Keyboard Writing Mode）。

---

## 6. 详细需求

### 6.1 移动端写作模式（Keyboard Writing Mode）

#### 6.1.1 触发条件

- 移动端设备上，当正文编辑区域中的 textarea 获得焦点，且软键盘弹出时：
  - 通过视口高度变化 + UA 检测，或聚焦 + UA 粗略判断。

#### 6.1.2 写作模式下的布局变化

- **必须隐藏/收起的元素**
  - 标签编辑区。
  - 笔记统计信息（字数、时间等）。
  - 非核心的顶部工具按钮（保留返回、标题、保存状态指示）。

- **可选精简的元素**
  - 顶部标题区域收窄行高，减少额外 padding。
  - 若标题已填写，写作模式下可将标题区域压缩为单行展示。

- **视图目标**
  - 在键盘弹出状态下，键盘上方可视区域中，≥ 70% 像素高度用于显示正文内容。

#### 6.1.3 退出写作模式

- 用户点击“完成/收起键盘”后，自动恢复完整布局。
- 用户点击页面非输入区域（例如返回、顶部栏）时，也可退出写作模式。

---

### 6.2 底部工具栏的移动端策略

#### 6.2.1 现状问题

- 常驻的底部工具栏在手机上占用显著高度，与键盘叠加后挤压内容区。

#### 6.2.2 新策略：两种形态

- **（1）常规浏览态（未弹键盘）**
  - 保留当前类似的底部工具栏，但：
    - 默认只展示少量主按钮（如：保存、预览、更多）。
    - 其他功能通过“更多（⋯）”进入二级操作面板。
  - 工具栏可以略微减小高度，但保持 44×44px 触控规范。

- **（2）写作模式（键盘弹出时）**
  - 底部工具栏不再以整条横向栏常驻。
  - 仅保留：
    - 一个浮动的主要操作按钮（如右下角圆形按钮，可配置为“完成”或“更多”）。
    - 或一条极细的“上滑手柄条”（上滑弹出完整工具选项）。
  - 原有那一排按钮在写作模式中不显示，避免与键盘叠加。

#### 6.2.3 交互要求

- 工具栏从常规态切换到写作模式态时：
  - 使用简单淡入/淡出或自下而上的轻动画。
  - 不影响输入焦点，不触发额外滚动跳动。

---

### 6.3 滚动与光标行为（防抖动、防跳顶）

#### 6.3.1 原则

- 移动端编辑过程中，不再频繁强制恢复父容器 `scrollTop`。
- 优先使用浏览器在键盘弹出时的默认行为，只在“切换视图/返回编辑页”时做一次适度恢复。

#### 6.3.2 具体需求

- **R-Scroll-1：编辑过程不干预父级滚动**
  - 在移动端，`SegmentedEditor` 内容变化时：
    - 不再每次输入都对 `editorScrollContainer` 设置 `scrollTop`。
    - 父级只记录当前滚动位置，用于后续“返回编辑视图”的恢复，不干预正在编辑过程中的自然滚动。

- **R-Scroll-2：视图切换时的滚动恢复**
  - 从「列表/概览」返回到「编辑页」时：
    - 若有记录的 `savedScrollTop` 且数值显著大于 0（例如 > 50px），则在页面初次渲染稳定后最多恢复一次。
    - 恢复逻辑不应在后续内容变更中再次触发，避免“写到一半又被拉走”。

- **R-Scroll-3：SegmentedEditor 内部恢复策略简化（移动端）**
  - 在移动端：
    - 允许 `SegmentedEditor` 继续恢复光标位置（selection range）。
    - 但应减少或取消主动设置 textarea 的 `scrollTop`，避免与浏览器默认行为冲突。
  - 桌面端逻辑可保持更激进的恢复，以保证鼠标滚轮下的编辑体验。

- **R-Scroll-4：禁止“循环恢复”**
  - 任何滚动恢复逻辑：
    - 每个“事件触发点”只允许尝试有限次数（例如 1–2 次）。
    - 不应通过 `setInterval` 或连续多重 `requestAnimationFrame + setTimeout` 长时间强制。

---

## 7. 非功能性需求

- **兼容性**
  - 优化针对主流移动浏览器（iOS Safari、Android Chrome）进行测试。
- **可访问性**
  - 写作模式下仍需保证：
    - 可通过明确按钮退出；
    - 工具入口对视觉不敏感用户亦明显可见。
- **性能**
  - 禁止因为滚动/光标恢复逻辑而引入新的性能瓶颈（长时间计时器、频繁 reflow）。

---

## 8. 验收标准（Acceptance Criteria）

- **AC-1：可视区域**
  - 在 iPhone 14 Pro / 常见 Android 机型上，键盘弹出时：
    - 截图测量，键盘上方区域中 ≥ 70% 像素高度用于显示正文内容。

- **AC-2：滚动稳定性**
  - 在移动端连续输入 30 秒：
    - 页面不出现明显的“自动跳到顶部”或来回抖动。
    - 编辑同一段长文时，光标附近内容始终可见。

- **AC-3：工具可达性**
  - 在写作模式下：
    - 不超过 2 次点击即可：
      - 触发保存；
      - 切换预览模式；
      - 退出写作模式。

- **AC-4：桌面端不回归**
  - 桌面端编辑器行为（滚动、光标恢复、工具栏显示）保持与现有版本一致或更好，不出现新异常。

---

## 9. 里程碑与实施顺序（建议）

1. **阶段 1：滚动与跳动问题修复（P0）**
   - 简化移动端滚动恢复逻辑，先保证“不乱跳”。
2. **阶段 2：写作模式 + 底部工具栏重构（P0）**
   - 实现键盘态精简布局 + 工具栏双形态。
3. **阶段 3：细节打磨（P1）**
   - 动画、过渡、按钮布局微调，基于真机体验迭代。


