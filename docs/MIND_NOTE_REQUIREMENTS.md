# 思维笔记功能需求文档

> 参考标准：幕布（Mubu）的设计和功能
> 本文档作为开发参考标准，确保功能完整性和一致性

## 一、核心功能

### 1.1 大纲笔记结构
- ✅ **树形层级结构**：支持无限层级的父子节点关系
- ✅ **节点展开/折叠**：每个节点可以独立展开或折叠其子节点
- ✅ **根节点折叠/展开**：根节点也支持折叠/展开功能
- ✅ **折叠全部/展开全部**：一键折叠或展开所有节点

### 1.2 节点内容
- ✅ **纯文本编辑**：每个节点支持多行文本内容
- ✅ **粘贴支持**：支持从剪贴板粘贴纯文本
- ✅ **空节点处理**：支持创建空节点，空节点可被删除
- ⏳ **Markdown支持**：支持Markdown语法（待实现）
- ⏳ **LaTeX公式**：支持数学公式编辑（待实现）
- ⏳ **富文本**：支持粗体、斜体、链接等（待实现）

### 1.3 文档管理
- ✅ **文档列表**：支持创建、查看、删除思维笔记
- ✅ **文件夹管理**：支持文件夹分类管理
- ✅ **搜索功能**：支持搜索笔记标题和内容
- ✅ **文档标题编辑**：支持编辑文档标题

## 二、编辑功能

### 2.1 节点操作
- ✅ **创建同级节点**：在当前节点下方创建同级节点（Enter）
- ✅ **创建子节点**：在当前节点下方创建子节点（Tab）
- ✅ **提升层级**：将节点提升一级（Shift+Tab）
- ✅ **降低层级**：将节点降低一级（待实现快捷键）
- ✅ **删除节点**：删除当前节点及其所有子节点（Backspace删除空节点）
- ✅ **拖拽移动**：通过拖拽改变节点位置和层级

### 2.2 编辑模式
- ✅ **单击编辑**：单击节点进入编辑模式
- ✅ **光标定位**：进入编辑模式时，光标定位到内容末尾（不自动全选）
- ✅ **失焦保存**：编辑失焦时自动保存
- ✅ **防抖保存**：输入内容时使用防抖机制，避免频繁保存

### 2.3 拖拽功能
- ✅ **拖拽手柄**：黑色圆点作为拖拽手柄
- ✅ **拖拽预览**：拖拽时显示视觉反馈
- ✅ **精确放置**：
  - 拖到节点上半部分：作为该节点的子节点
  - 拖到节点下半部分：作为该节点的同级节点
- ✅ **拖拽子节点**：拖拽父节点时，子节点一起移动
- ✅ **拖拽到文件夹**：支持将笔记拖拽到文件夹

## 三、快捷键系统

### 3.1 PC端快捷键（编辑模式）
- ✅ **Enter**：在当前节点下方创建同级节点
- ✅ **Tab**：在当前节点下方创建子节点
- ✅ **Shift+Tab**：提升节点层级（提升一级）
- ✅ **Backspace**：当光标在行首且内容为空时，删除节点
- ⏳ **Ctrl+Z / Cmd+Z**：撤销操作（待实现）
- ⏳ **Ctrl+Y / Cmd+Y**：重做操作（待实现）
- ⏳ **Ctrl+A / Cmd+A**：全选当前节点内容（待实现）
- ⏳ **Ctrl+B / Cmd+B**：加粗（待实现）
- ⏳ **Ctrl+I / Cmd+I**：斜体（待实现）

### 3.2 全局快捷键
- ✅ **快捷键帮助**：点击帮助按钮显示快捷键列表
- ⏳ **Ctrl+N / Cmd+N**：新建思维笔记（待实现）
- ⏳ **Ctrl+F / Cmd+F**：搜索（待实现）
- ⏳ **Ctrl+S / Cmd+S**：保存（待实现）

### 3.3 移动端操作
- ✅ **长按选择**：长按节点进入多选模式
- ✅ **触摸拖拽**：支持触摸拖拽移动节点
- ✅ **工具栏操作**：移动端显示操作工具栏（添加、删除、缩进等）

## 四、UI/UX设计规范

### 4.1 视觉设计（参考飞书云文档）
- ✅ **简洁风格**：无边框、无背景色，极简设计
- ✅ **黑色圆点**：每个节点前有一个黑色圆点（w-2 h-2）
- ✅ **垂直连接线**：
  - 仅当节点展开时显示
  - 从父节点的圆点中心垂直延伸到最后一个子节点
  - 细线（w-px），黑色（bg-neutral-900）
- ✅ **折叠/展开图标**：
  - 仅当节点有子节点时显示
  - 默认隐藏，鼠标悬停在圆点区域时显示
  - 显示时显示提示气泡（"折叠"/"展开"）
- ✅ **操作按钮**：
  - 默认隐藏，鼠标悬停在节点上时显示
  - 圆形按钮，尺寸 w-7 h-7，提升点击体验
  - 包括：添加子节点、添加同级节点、提升层级、降低层级、删除

### 4.2 布局规范
- ✅ **缩进规则**：每级缩进 1.5rem（24px）
- ✅ **节点间距**：节点之间垂直间距紧凑（py-0.5）
- ✅ **圆点对齐**：所有节点的圆点必须在同一条垂直线上
- ✅ **标题大小**：文档标题使用一级标题大小（text-3xl）
- ✅ **字体大小**：支持全局字体大小调节（10px-24px）

### 4.3 响应式设计
- ✅ **移动端适配**：支持手机、平板等移动设备
- ✅ **触摸优化**：按钮尺寸适合手指点击
- ✅ **工具栏适配**：移动端显示底部工具栏
- ✅ **导航入口**：移动端和桌面端都有清晰的入口

## 五、交互细节

### 5.1 节点选择
- ✅ **单击选择**：单击节点选中节点（非编辑模式）
- ✅ **多选模式**：移动端长按进入多选模式
- ✅ **选中高亮**：选中的节点有背景色高亮

### 5.2 拖拽交互
- ✅ **拖拽激活**：按住圆点开始拖拽
- ✅ **拖拽反馈**：拖拽时显示半透明效果
- ✅ **放置区域高亮**：拖拽到可放置区域时显示高亮
- ✅ **拖拽取消**：拖拽到无效区域时恢复原位置

### 5.3 编辑交互
- ✅ **防重复操作**：快速按键时防止重复创建节点
- ✅ **光标管理**：编辑时正确管理光标位置
- ✅ **粘贴处理**：粘贴时自动处理换行和格式

## 六、性能优化

### 6.1 数据加载
- ✅ **乐观更新**：操作后立即更新UI，异步保存到数据库
- ✅ **防抖保存**：输入内容时使用防抖，减少API调用
- ✅ **避免重载**：操作后不重新加载整个文档

### 6.2 渲染优化
- ✅ **虚拟滚动**：大量节点时使用虚拟滚动（待实现）
- ✅ **懒加载**：折叠的节点不渲染子节点（已实现）
- ✅ **动画优化**：使用CSS过渡动画，避免JS动画

## 七、高级功能（待实现）

### 7.1 内容增强
- ⏳ **Markdown渲染**：支持Markdown语法
- ⏳ **LaTeX公式**：支持数学公式
- ⏳ **代码块**：支持代码高亮
- ⏳ **链接**：支持内部链接和外部链接
- ⏳ **图片**：支持插入图片
- ⏳ **附件**：支持插入附件

### 7.2 协作功能
- ⏳ **多人协作**：支持多人实时编辑
- ⏳ **评论系统**：支持节点评论
- ⏳ **版本历史**：支持查看历史版本

### 7.3 导出与分享
- ⏳ **导出PDF**：支持导出为PDF
- ⏳ **导出图片**：支持导出为图片
- ⏳ **导出Markdown**：支持导出为Markdown
- ⏳ **分享链接**：支持生成分享链接

### 7.4 其他功能
- ⏳ **模板系统**：支持使用模板
- ⏳ **标签系统**：支持节点标签
- ⏳ **待办事项**：支持节点待办标记
- ⏳ **思维导图视图**：支持切换为思维导图视图

## 八、技术规范

### 8.1 数据结构
```typescript
interface MindNoteNode {
  id: string;
  content: string;
  parent_id: string | null;
  order: number;
  is_expanded: boolean;
  children?: MindNoteNode[];
}
```

### 8.2 API规范
- ✅ **创建节点**：`POST /api/mind-note-nodes`
- ✅ **更新节点**：`PUT /api/mind-note-nodes/:id`
- ✅ **删除节点**：`DELETE /api/mind-note-nodes/:id`
- ✅ **批量更新顺序**：`POST /api/mind-note-nodes/batch-update-order`

### 8.3 状态管理
- ✅ **本地状态**：使用React state管理节点树
- ✅ **乐观更新**：操作后立即更新本地状态
- ✅ **错误处理**：操作失败时回滚到之前状态

## 九、测试检查清单

### 9.1 基础功能
- [ ] 创建、编辑、删除节点
- [ ] 节点展开/折叠
- [ ] 拖拽移动节点
- [ ] 快捷键操作
- [ ] 粘贴内容

### 9.2 边界情况
- [ ] 空节点处理
- [ ] 根节点操作
- [ ] 深层嵌套（10+层）
- [ ] 大量节点（100+节点）
- [ ] 网络错误处理

### 9.3 跨平台
- [ ] PC端浏览器（Chrome、Firefox、Safari、Edge）
- [ ] 移动端浏览器（iOS Safari、Chrome Mobile）
- [ ] 响应式布局（不同屏幕尺寸）

## 十、已知问题和待优化

### 10.1 已知问题
- [ ] 节点缩进对齐问题（已修复，需验证）
- [ ] 快速按键可能触发多次操作（已修复，需验证）

### 10.2 待优化
- [ ] 大文档性能优化（虚拟滚动）
- [ ] 撤销/重做功能
- [ ] 更好的错误提示
- [ ] 加载状态优化

---

## 更新日志

- **2024-12-XX**：创建需求文档
- **2024-12-XX**：修复节点缩进对齐问题
- **2024-12-XX**：统一标题大小（桌面端和移动端）

---

## 参考资源

- [幕布官网](https://mubu.com/)
- [飞书云文档思维笔记](https://www.feishu.cn/)
- [Workflowy - 大纲笔记工具](https://workflowy.com/)
- [Notion - 笔记工具](https://www.notion.so/)


